<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>webxdc</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Intro</a></li><li class="chapter-item expanded "><a href="get_started.html"><strong aria-hidden="true">1.</strong> Get Started</a></li><li class="chapter-item expanded "><a href="spec.html"><strong aria-hidden="true">2.</strong> Webxdc Specification</a></li><li class="chapter-item expanded "><a href="tips_and_tricks.html"><strong aria-hidden="true">3.</strong> Tips & Tricks</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">webxdc</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/deltachat/webxdc_docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Webxdc is a new way to develop, share and use web apps in messenger chat groups. Anyone can build html5 apps without permission and share it with friends by simply sending a message with an attached <code>.xdc</code> file as defined by <a href="spec.html#webxdc-file-format">file format</a>. Once a webxdc app is shared in a chat, its members can click &quot;start&quot; to run the app and interact with each other through the app. </p>
<iframe style="max-width: 100%" width="560" height="315" src="https://www.youtube-nocookie.com/embed/I1K4pBvb2pI" title="YouTube video player" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Webxdc apps can only send and receive messages in the chat by using the <a href="spec.html#webxdc-api">Javascript API</a> provided by the messenger. Each Webxdc app thus gets automatic end-to-end encryption and peer discovery for free. </p>
<p>Webxdc is specified through its <a href="spec.html#webxdc-file-format">file format</a> and <a href="spec.html#webxdc-api">Javascript API</a> for developing web apps, and through instructions on the <a href="spec.html#messenger-implementation">Messenger implementation</a> for running and sharing webxdc apps in chats. Webxdc is supported and evolving in conjunction with the <a href="https://delta.chat">Delta Chat</a> e-mail messenger apps which, if in doubt, serves as the default reference. </p>
<p>You can follow and participate in further developments in the <a href="https://github.com/webxdc">webxdc GitHub organization</a> and are invited to ask questions and post suggestions in <a href="https://support.delta.chat/c/webxdc/20">the &quot;webxdc&quot; support forum</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<h2 id="a-first-chat-example"><a class="header" href="#a-first-chat-example">A First &quot;chat&quot; Example</a></h2>
<p>The following complete <code>index.html</code> webxdc app example shows an input field and every input is show on all peers.</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;script src=&quot;webxdc.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;input id=&quot;input&quot; type=&quot;text&quot;/&gt;
    &lt;a href=&quot;&quot; onclick=&quot;sendMsg(); return false;&quot;&gt;Send&lt;/a&gt;
    &lt;p id=&quot;output&quot;&gt;&lt;/p&gt;
    &lt;script&gt;
    
      function sendMsg() {
        msg = document.getElementById(&quot;input&quot;).value;
        window.webxdc.sendUpdate({payload: msg}, 'Someone typed &quot;'+msg+'&quot;.');
      }
    
      function receiveUpdate(update) {
        document.getElementById('output').innerHTML += update.payload + &quot;&lt;br&gt;&quot;;
      }
    
      window.webxdc.setUpdateListener(receiveUpdate, 0);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Now zip the directory containing the <code>index.html</code>:</p>
<pre><code class="language-shell">zip -9 --recurse-paths &quot;myapp.xdc&quot; PATH_TO_DIR
</code></pre>
<p>You can now share the resulting <code>myapp.xdc</code> file in a chat and everyone can hit &quot;start&quot; to start our little &quot;chat app&quot;. </p>
<p>However, for faster and more convenient development round trips we recommend to try using the minimal <a href="https://github.com/webxdc/hello">hello webxdc development</a> tool.</p>
<h2 id="many-more-examples-to-work-from"><a class="header" href="#many-more-examples-to-work-from">Many More Examples to Work From</a></h2>
<p>Each of the working examples on <a href="https://webxdc.org">webxdc home page</a> comes with source-code references, usually pointing to repositories in the <a href="https://github.com/webxdc">Webxdc organisation on github</a>.</p>
<h2 id="participating-in-developments"><a class="header" href="#participating-in-developments">Participating in Developments</a></h2>
<ul>
<li>
<p><a href="https://github.com/webxdc">Webxdc Github org</a> containing many example app repositories
Please tag your own app experiments with the &quot;webxdc&quot; topic so that others may find it 
via the <a href="https://github.com/topics/webxdc"><code>#webxdc</code> Topic on GitHub</a>. </p>
</li>
<li>
<p>Support Forum: You can ask questions and announce your app projects on the DeltaChat forum under the <a href="https://support.delta.chat/c/webxdc/20"><code>webxdc</code> category</a>. You can login into the <a href="https://support.delta.chat">forum</a> via DeltaChat, Github or by creating a normal account there.</p>
</li>
<li>
<p>Announcements: You may follow Delta Chat and Webxdc-related developments through the <a href="https://chaos.social/web/delta">Delta Fediverse</a> or the <a href="https://twitter.com/delta_chat">Delta Twitter</a> accounts. </p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="webxdc-specification"><a class="header" href="#webxdc-specification">Webxdc Specification</a></h1>
<p>Webxdc is a fresh and still evolving way of running web apps in chat messengers. This document describes the [Webxdc API] and <code>.xdc</code> [file format] for app developers. It also describes the constraints for a [messenger implementation] for when it launches webxdc apps for its users. </p>
<h2 id="webxdc-api"><a class="header" href="#webxdc-api">Webxdc API</a></h2>
<p>A Webxdc app is shared in a chat and run independently on each device when a user clicks &quot;start&quot;. 
To share application state, the otherwise network-isolated app instances use <code>sendUpdate()</code> and <code>setUpdateListener()</code> to exchange information. Messenger implementations expose implementations for this API through the <code>webxdc.js</code> module. To activate the webxdc API you need to use a script reference for <code>webxdc.js</code> in your HTML5 app:</p>
<pre><code class="language-html">&lt;script src=&quot;webxdc.js&quot;&gt;&lt;/script&gt;
</code></pre>
<h3 id="sendupdate"><a class="header" href="#sendupdate">sendUpdate()</a></h3>
<pre><code class="language-js">window.webxdc.sendUpdate(update, descr);
</code></pre>
<ul>
<li>
<p><code>update</code>: an object with the following properties:</p>
<ul>
<li><code>update.payload</code>: any javascript primitive, array or object.</li>
<li><code>update.info</code>: optional, short, informational message that will be added to the chat,
eg. &quot;Alice voted&quot; or &quot;Bob scored 123 in MyGame&quot;.
usually only one line of text is shown
and if there are series of info messages, older ones may be dropped.
use this option sparingly to not spam the chat.</li>
<li><code>update.document</code>: optional, name of the document in edit,
must not be used eg. in games where the Webxdc does not create documents</li>
<li><code>update.summary</code>: optional, short text, shown beside Webxdc icon;
it is recommended to use some aggregated value,  eg. &quot;8 votes&quot;, &quot;Highscore: 123&quot;</li>
</ul>
</li>
<li>
<p><code>descr</code>: short, human-readable description what this update is about.
this is shown eg. as a fallback text in an email program.</p>
</li>
</ul>
<p>All peers, including the sending one,
will receive the update by the callback given to <code>setUpdateListener()</code>.</p>
<p>There are situations where the user cannot send messages to a chat,
eg. if the webxdc instance comes as a contact request or if the user has left a group.
In these cases, you can still call <code>sendUpdate()</code>,
however, the update won't be sent to other peers
and you won't get the update by <code>setUpdateListener()</code>.</p>
<h3 id="setupdatelistener"><a class="header" href="#setupdatelistener">setUpdateListener()</a></h3>
<pre><code class="language-js">let promise = window.webxdc.setUpdateListener((update) =&gt; {}, serial);
</code></pre>
<p>With <code>setUpdateListener()</code> you define a callback that receives the updates
sent by <code>sendUpdate()</code>. The callback is called for updates sent by you or other peers.
The <code>serial</code> specifies the last serial that you know about (defaults to 0). 
The returned promise resolves when the listener has processed all the update messages known at the time when  <code>setUpdateListener</code> was called. </p>
<p>Each <code>update</code> which is passed to the callback comes with the following properties: </p>
<ul>
<li>
<p><code>update.payload</code>: equals the payload given to <code>sendUpdate()</code></p>
</li>
<li>
<p><code>update.serial</code>: the serial number of this update.
Serials are larger <code>0</code> and newer serials have higher numbers.
There may be gaps in the serials
and it is not guaranteed that the next serial is exactly incremented by one.</p>
</li>
<li>
<p><code>update.max_serial</code>: the maximum serial currently known.
If <code>max_serial</code> equals <code>serial</code> this update is the last update (until new network messages arrive).</p>
</li>
<li>
<p><code>update.info</code>: optional, short, informational message (see <code>sendUpdate()</code>)</p>
</li>
<li>
<p><code>update.document</code>: optional, document name as set by the sender, (see <code>sendUpdate()</code>),
implementations show the document name eg. beside the app icon or in the title bar</p>
</li>
<li>
<p><code>update.summary</code>: optional, short text, shown beside icon (see <code>sendUpdate()</code>)</p>
</li>
</ul>
<h3 id="selfaddr"><a class="header" href="#selfaddr">selfAddr</a></h3>
<pre><code class="language-js">window.webxdc.selfAddr
</code></pre>
<p>Property with the peer's own address.
This is esp. useful if you want to differ between different peers -
just send the address along with the payload,
and, if needed, compare the payload addresses against selfAddr() later on.</p>
<h3 id="selfname"><a class="header" href="#selfname">selfName</a></h3>
<pre><code class="language-js">window.webxdc.selfName
</code></pre>
<p>Property with the peer's own name.
This is name chosen by the user in their settings,
if there is nothing set, that defaults to the peer's address.</p>
<h2 id="other-apis-and-tags-usage-hints"><a class="header" href="#other-apis-and-tags-usage-hints">Other APIs and Tags Usage Hints</a></h2>
<ul>
<li><code>localStorage</code>, <code>sessionStorage</code>, <code>indexedDB</code> are okay to be used</li>
<li><code>visibilitychange</code>-events are okay to be used</li>
<li><code>window.navigator.language</code> is okay to be used, on desktop it is the system language</li>
<li><code>&lt;a href=&quot;localfile.html&quot;&gt;</code> and other internal links are okay to be used</li>
<li><code>&lt;a href=&quot;mailto:addr@example.org?body=...&quot;&gt;</code>- mailto links are okay to be used</li>
<li><code>&lt;meta name=&quot;viewport&quot; ...&gt;</code> usage is okay to be used
and useful esp. different webviews have different defaults</li>
</ul>
<h3 id="discouraged-practises"><a class="header" href="#discouraged-practises">Discouraged Practises</a></h3>
<ul>
<li><code>document.cookie</code> is known not to work on desktop and iOS
use <code>localStorage</code> instead</li>
<li><code>unload</code>-, <code>beforeunload</code>- and <code>pagehide</code>-events are known not to work on iOS and are flaky on other systems
(also partly discouraged by <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event">mozilla</a>)
use <code>visibilitychange</code> instead</li>
<li><code>&lt;title&gt;</code> and <code>document.title</code> is ignored by Webxdc;
use the <code>name</code> property from <code>manifest.toml</code> instead</li>
<li>newest js features may not work on all webviews,
you may want to transpile your code down to an older js version
eg. with <a href="https://babeljs.io">https://babeljs.io</a></li>
<li><code>&lt;a href=&quot;https://example.org/foo&quot;&gt;</code> and other external links are blocked by definition;
instead, embed content or use <code>mailto:</code> link to offer a way for contact</li>
<li><code>&lt;input type=&quot;file&quot;&gt;</code> is discouraged currently; this may change in future</li>
</ul>
<h2 id="webxdc-file-format"><a class="header" href="#webxdc-file-format">Webxdc File Format</a></h2>
<ul>
<li>a <strong>Webxdc</strong> is a <strong>ZIP-file</strong> with the extension <code>.xdc</code></li>
<li>the ZIP-file MUST use the default compression methods as of RFC 1950,
this is &quot;Deflate&quot; or &quot;Store&quot;</li>
<li>the ZIP-file MUST contain at least the file <code>index.html</code></li>
<li>the ZIP-file MAY contain a <code>manifest.toml</code> and <code>icon.png</code> or
<code>icon.jpg</code> files</li>
<li>if the Webxdc app is started, <code>index.html</code> MUST be opened in a [restricted
webview](Webview constraints for running apps) that allow accessing 
resources only from the ZIP-file.</li>
</ul>
<h3 id="the-manifesttoml-file"><a class="header" href="#the-manifesttoml-file">The manifest.toml File</a></h3>
<p>If the ZIP-file contains a <code>manifest.toml</code> in its root directory,
the following basic information MUST be read from it: </p>
<pre><code class="language-toml">name = &quot;My Name&quot;
source_code_url = &quot;https://example.org/orga/repo&quot;
</code></pre>
<ul>
<li>
<p><code>name</code> - The name of the Webxdc app.
If no name is set or if there is no manifest, the filename is used as the Webxdc name.</p>
</li>
<li>
<p><code>source_code_url</code> - Optional URL where the source code of the Webxdc and maybe other information can be found.
Messenger implementors may make the url accessible via a &quot;Help&quot; menu in the Webxdc window.</p>
</li>
</ul>
<h3 id="icon-files"><a class="header" href="#icon-files">Icon Files</a></h3>
<p>If the ZIP-root contains an <code>icon.png</code> or <code>icon.jpg</code>,
these files are used as the icon for the Webxdc.
The icon should be a square at reasonable width/height;
round corners etc. will be added by the implementations as needed.
If no icon is set, a default icon will be used.</p>
<h2 id="messenger-implementation"><a class="header" href="#messenger-implementation">Messenger Implementation</a></h2>
<h3 id="webview-constraints-for-running-apps"><a class="header" href="#webview-constraints-for-running-apps">Webview Constraints for Running Apps</a></h3>
<p>Messenger implementors need to implement the following restrictions when starting a web view for a webxdc app to run:</p>
<ul>
<li>
<p>You MUST deny all forms of internet access. If you don't do this
unsuspecting users may leak data of their private interactions to outside third parties. 
You do not need to offer &quot;privacy&quot; or &quot;cookie&quot; consent screens as 
there is no way the app can transfer user data to anything outside the chat. </p>
</li>
<li>
<p>You MUST allow unrestricted use of DOM storage (local storage, indexed db and co), 
but make sure it is scoped to each webxdc app so they can not delete or modify 
the data of other webxdc content.</p>
</li>
<li>
<p>You MUST offer an implementation for <code>webxdc.js</code> implementing the
[Webxdc API] such that messages are relayed and shown in chats. </p>
</li>
</ul>
<h3 id="ui-interactions-in-chats"><a class="header" href="#ui-interactions-in-chats">UI Interactions in Chats</a></h3>
<ul>
<li>Info messages  in chats -&gt; click on them should jump to their webxdc message</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tips-and-tricks"><a class="header" href="#tips-and-tricks">Tips and Tricks</a></h1>
<h2 id="typescript-support"><a class="header" href="#typescript-support">Typescript Support</a></h2>
<p>How to get autocompletion for window.webxdc api in you IDE via typescript.</p>
<h3 id="get-the-typescript-definitions"><a class="header" href="#get-the-typescript-definitions">Get the Typescript Definitions</a></h3>
<p>Just copy <a href="https://github.com/deltachat/webxdc_docs/blob/master/webxdc.d.ts"><code>webxdc.d.ts</code></a> into your source dir:</p>
<pre><code class="language-typescript">type SendingStatusUpdate&lt;T&gt; = {
  /** the payload, deserialized json:
   * any javascript primitive, array or object. */
  payload: T;
  /** optional, short, informational message that will be added to the chat,
   * eg. &quot;Alice voted&quot; or &quot;Bob scored 123 in MyGame&quot;;
   * usually only one line of text is shown,
   * use this option sparingly to not spam the chat. */
  info?: string;
  /** optional, if the Webxdc creates a document, you can set this to the name of the document;
   * do not set if the Webxdc does not create a document */
  document?: string;
  /** optional, short text, shown beside the icon;
   * it is recommended to use some aggregated value,
   * eg. &quot;8 votes&quot;, &quot;Highscore: 123&quot; */
  summary?: string;
};

type ReceivedStatusUpdate&lt;T&gt; = {
  /** the payload, deserialized json */
  payload: T;
  /** the serial number of this update. Serials are larger than 0 and newer serials have higher numbers */
  serial: number;
  /** the maximum serial currently known */
  max_serial: number;
  /** optional, short, informational message. */
  info?: string;
  /** optional, if the Webxdc creates a document, this is the name of the document;
   * not set if the Webxdc does not create a document */
  document?: string;
  /** optional, short text, shown beside the webxdc's icon. */
  summary?: string;
};

interface Webxdc&lt;T&gt; {
  /** Returns the peer's own address.
   *  This is esp. useful if you want to differ between different peers - just send the address along with the payload,
   *  and, if needed, compare the payload addresses against selfAddr() later on. */
  selfAddr: string;
  /** Returns the peer's own name. This is name chosen by the user in their settings, if there is nothing set, that defaults to the peer's address. */
  selfName: string;
  /**
   * set a listener for new status updates.
   * The &quot;serial&quot; specifies the last serial that you know about (defaults to 0).
   * Note that own status updates, that you send with {@link sendUpdate}, also trigger this method
   * @returns promise that resolves when the listener has processed all the update messages known at the time when `setUpdateListener` was called.
   * */
  setUpdateListener(cb: (statusUpdate: ReceivedStatusUpdate&lt;T&gt;) =&gt; void, serial?: number): Promise&lt;void&gt;;
  /**
   * WARNING! This function is deprecated, see setUpdateListener().
   */
  getAllUpdates(): Promise&lt;ReceivedStatusUpdate&lt;T&gt;[]&gt;;
  /**
   * Webxdc are usually shared in a chat and run independently on each peer. To get a shared status, the peers use sendUpdate() to send updates to each other.
   * @param update status update to send
   * @param description short, human-readable description what this update is about. this is shown eg. as a fallback text in an email program.
   */
  sendUpdate(update: SendingStatusUpdate&lt;T&gt;, description: string): void;
}

////////// ANCHOR: global
declare global {
  interface Window {
    webxdc: Webxdc&lt;any&gt;;
  }
}
////////// ANCHOR_END: global

export { SendingStatusUpdate, ReceivedStatusUpdate, Webxdc };
</code></pre>
<p>you can find it also on <a href="https://github.com/deltachat/webxdc_docs/blob/master/webxdc.d.ts">https://github.com/deltachat/webxdc_docs/blob/master/webxdc.d.ts</a> or just copy the code block above.</p>
<blockquote>
<p>In the future this might become an @types npm module, but for now it is what it is: <em>a simple file copy with <strong>no</strong> automatic updates</em>.</p>
</blockquote>
<h3 id="using-the-types"><a class="header" href="#using-the-types">Using the Types</a></h3>
<p>for using the types you need to import the file.</p>
<p>Using in typescript: </p>
<pre><code class="language-tyspescript">import type { Webxdc } from './webxdc.d.ts'
</code></pre>
<p>using in Javascript:</p>
<pre><code class="language-javascript">/**
 * @typedef {import('./webxdc').Webxdc} Webxdc
 */
</code></pre>
<p>This works in vscode nicely together with the <code>//@ts-check</code> comment on top of your source file.</p>
<p>If you want you can also type your own functions using <a href="https://jsdoc.app/">JSDoc comments</a>.</p>
<blockquote>
<p>If you don't use vscode you can still make use of the type checking with the typescript compiler:</p>
<pre><code class="language-sh">npm i -g typescript # -g stands for global installation
tsc --noEmit --allowJs --lib es2015,dom *.js
</code></pre>
</blockquote>
<h3 id="own-payload-type"><a class="header" href="#own-payload-type">Own Payload Type</a></h3>
<p>If you have a type for your state update <strong>payloads</strong>, replace the <code>any</code> in <code>Webxdc&lt;any&gt;</code> with your own payload type:</p>
<pre><code class="language-typescript">declare global {
  interface Window {
    webxdc: Webxdc&lt;any&gt;;
  }
}
</code></pre>
<h2 id="transpile-newer-javascript-with-babeljs"><a class="header" href="#transpile-newer-javascript-with-babeljs">Transpile Newer Javascript With Babel.js</a></h2>
<p>Older devices might not have the newest javascript features/syntax in their webview, you may want to transpile your code down to an older js version eg. with <a href="https://babeljs.io">https://babeljs.io</a></p>
<p>TODO guide, TODO find out what the oldest browser/webview version is that we support.</p>
<p>Targets:</p>
<ul>
<li>Desktop (electron -&gt; is chrome 91)</li>
<li>iOS (iOS 11 -&gt; webkit 604.1.38)</li>
<li>android (android 5 -&gt; the webview system component can be updated by the user: <a href="https://play.google.com/store/apps/details?id=com.google.android.webview">https://play.google.com/store/apps/details?id=com.google.android.webview</a>)</li>
</ul>
<p>If you want to use a newer API make sure to check on <a href="https://caniuse.com">https://caniuse.com</a>. If you just want to use newer JavaScript syntax, babel.js is the right tool for you - it translates new JS into older JS, that can be interpreted.</p>
<h2 id="debugging-with-erudajs"><a class="header" href="#debugging-with-erudajs">Debugging With eruda.js</a></h2>
<p>When you can not use <a href="05_03_debugging_in_deltachat.html">debugging inside Deltachat</a>, either because you have no computer to connect to or are on iOS, you can use <a href="https://github.com/liriliri/eruda">eruda.js</a> as an alternative to the native dev tools.</p>
<h3 id="installing-eruda"><a class="header" href="#installing-eruda">Installing eruda</a></h3>
<p>Get <code>eruda.js</code> from https://github.com/liriliri/eruda, copy it next to your <code>index.html</code> and then add this snippet into the head section of your index.html, before all other scripts:</p>
<pre><code class="language-html">&lt;script src=&quot;eruda.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  eruda.init();
&lt;/script&gt;
</code></pre>
<h3 id="using-eruda"><a class="header" href="#using-eruda">Using eruda</a></h3>
<p>When you open the webxdc a floating button will appear in a corner, tap it to see the developer tools.</p>
<h2 id="debugging-inside-deltachat"><a class="header" href="#debugging-inside-deltachat">Debugging Inside Deltachat</a></h2>
<h3 id="debug-your-webxdc-content-in-android-via-chrome-devtools"><a class="header" href="#debug-your-webxdc-content-in-android-via-chrome-devtools">Debug Your webxdc Content in Android via Chrome DevTools</a></h3>
<ol>
<li>enable webView debugging in delta chat settings <code>Settings</code> &gt; <code>Advanced</code> &gt; <code>Developer Mode</code>: <img alt="image of andvanced screen" src="images/android_remote_debug_enable.png" style="max-height:40vh" /></li>
<li>enable developer mode and ADB debugging on your device <em>(go to system settings, device info, spam click on build number until there is a toast telling you that you are now a &quot;Developer&quot;, then go into the developer menu that just appeared and enable &quot;ADB debugging&quot;, see also <a href="https://developer.android.com/studio/command-line/adb#Enabling">android docs: Enable ADB debugging on your device</a>).</em></li>
<li>connect your device via USB to your computer</li>
<li>open chromium (or google chrome) and go to <code>chrome://inspect/#devices</code></li>
<li>start your webxdc that you want to debug</li>
<li>click on <code>inspect</code>:</li>
</ol>
<p>
<img
src="images/android_remote_debug_list.png"
alt="screenshot of chrome dev tools device list"
style="max-height:40vh"
/>
</p>
<table><thead><tr><th>Inpect HTML</th><th>Javascript Console</th></tr></thead><tbody>
<tr><td><img src="images/android_remote_debug_inspector.png" alt="dev tools inpector" /></td><td><img src="images/android_remote_debug_console.png" alt="dev tools js console" /></td></tr>
</tbody></table>
<blockquote>
<p>Make sure to <strong>disable adb debugging again</strong> after you are done with debugging!</p>
</blockquote>
<h3 id="debug-your-webxdc-content-in-deltachat-desktop"><a class="header" href="#debug-your-webxdc-content-in-deltachat-desktop">Debug Your webxdc Content in DeltaChat Desktop</a></h3>
<p>Start the webxdc you want to debug and press <code>F12</code> to open the developer tools:</p>
<p>
<img
src="images/desktop_debug_open.png"
alt="screenshot of desktop webxdc window with devtool"
style="max-height:40vh"
/>
</p>
<p>A bit small isn't it? fix it either by resizing the window's <strong>width</strong> or <strong>undock</strong> the developer tools:</p>
<p>
<img
src="images/desktop_debug_undock.png"
alt="undock devtools"
style="max-height:40vh"
/>
</p>
<p>
<img
src="images/desktop_debug_extra_window.png"
alt="undock devtools"
style="max-height:40vh"
/>
</p>
<h2 id="optimizing-your-app-icon"><a class="header" href="#optimizing-your-app-icon">Optimizing Your App Icon</a></h2>
<p>There are several things you can do to shrink down the size of your icon:</p>
<ul>
<li>save without thumbnail image (in gimp it can be done in the export dialog)</li>
<li>shrink the image resolution (<code>256px</code> are enough, in some cases <code>128px</code> or even lower like <code>64px</code> can sufice)</li>
<li>change your PNG colors from <code>RGB</code> to <code>Indexed</code> (in gimp <code>Image</code> -&gt; <code>Mode</code> -&gt; <code>Indexed</code>, see <a href="https://docs.gimp.org/en/gimp-image-convert-indexed.html">https://docs.gimp.org/en/gimp-image-convert-indexed.html</a>)</li>
</ul>
<blockquote>
<p>For <code>png</code> you can also use the <code>oxipng</code> tool (<a href="https://github.com/shssoichiro/oxipng">https://github.com/shssoichiro/oxipng</a>), which automagically optimizes your icon's file size without quality loss:</p>
<pre><code>oxipng icon.png -s -o max
</code></pre>
<p>If you have png files in your project, you should also do this them to safe even more bytes.</p>
<p>Noteworthy parameters:</p>
<ul>
<li><code>--pretend</code> only calculates gains</li>
<li><code>-Z</code> even more compression, but takes longer</li>
<li>for more info see <code>oxipng --help</code># Troubleshooting</li>
</ul>
</blockquote>
<h2 id="i-cannot-share-variables-on-ios-between-scripts"><a class="header" href="#i-cannot-share-variables-on-ios-between-scripts">I Cannot Share Variables on iOS Between Scripts!</a></h2>
<p>Your code:</p>
<p><code>a.js</code></p>
<pre><code class="language-js">const CONFIG = { difficulty: &quot;hard&quot;, hasCoins: true };
</code></pre>
<p><code>b.js</code></p>
<pre><code class="language-js">if (CONFIG.difficulty == &quot;hard&quot;) {
  /** make the game harder **/
}
</code></pre>
<p><code>index.html</code></p>
<pre><code class="language-html">&lt;html&gt;
  &lt;head&gt;
    &lt;!-- ... --&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- ... --&gt;
    &lt;script src=&quot;a.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;b.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Basically you get many errors in your JS console like this:</p>
<pre><code>Can't find variable: CONFIG
</code></pre>
<p>There are a few ways to solve this:</p>
<ul>
<li>use a bundle to bundle all your JS to one file (some bundlers: parcel, webpack, esbuild)</li>
<li>use esm modules (see <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules</a>)</li>
<li>define your variables as inline script in your HTML file. (inline script means that the script is in the HTML file between the <code>&lt;script&gt;</code> tags: <code>&lt;script&gt;my code&lt;/script&gt;</code>)</li>
<li>append your global variables to the window object: <code>window.myVar = 1;</code> and use them like <code>console.log(window.myVar)</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
